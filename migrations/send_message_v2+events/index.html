<!doctype html>
<html lang="fa-IR" dir="rtl" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-migrations/send_message_v2+events" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">مهاجرت ارسال پیام و رویداد‌ها | کنار دیوار</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://divar-ir.github.io/kenar-docs/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://divar-ir.github.io/kenar-docs/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://divar-ir.github.io/kenar-docs/migrations/send_message_v2+events"><meta data-rh="true" property="og:locale" content="fa_IR"><meta data-rh="true" name="docusaurus_locale" content="fa-IR"><meta data-rh="true" name="docsearch:language" content="fa-IR"><meta data-rh="true" name="title" content="کنار دیوار"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="مهاجرت ارسال پیام و رویداد‌ها | کنار دیوار"><meta data-rh="true" name="description" content="لیست تغییرات"><meta data-rh="true" property="og:description" content="لیست تغییرات"><link data-rh="true" rel="icon" href="/kenar-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://divar-ir.github.io/kenar-docs/migrations/send_message_v2+events"><link data-rh="true" rel="alternate" href="https://divar-ir.github.io/kenar-docs/migrations/send_message_v2+events" hreflang="fa-IR"><link data-rh="true" rel="alternate" href="https://divar-ir.github.io/kenar-docs/migrations/send_message_v2+events" hreflang="x-default"><link rel="stylesheet" href="/kenar-docs/assets/css/styles.d9f4986f.css">
<script src="/kenar-docs/assets/js/runtime~main.f126b732.js" defer="defer"></script>
<script src="/kenar-docs/assets/js/main.7e4a22fb.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/kenar-docs/img/logo.svg"><div role="region" aria-label="پرش به مطلب اصلی"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">پرش به مطلب اصلی</a></div><nav aria-label="صفحه اصلی" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="باز و بست منو" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/kenar-docs/"><div class="navbar__logo"><img src="/kenar-docs/img/logo.svg" alt="کنار دیوار" class="themedComponent_mlkZ themedComponent--light_NVdE" width="64"><img src="/kenar-docs/img/logo.svg" alt="کنار دیوار" class="themedComponent_mlkZ themedComponent--dark_xIcU" width="64"></div><b class="navbar__title text--truncate">| مستندات فنی</b></a><a href="https://github.com/divar-ir/kenar-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="بین حالت تاریک و روشن سوئیچ کنید (الان حالت روشن)" aria-label="بین حالت تاریک و روشن سوئیچ کنید (الان حالت روشن)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="بازگشت به بالا" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="نوار کناری مستندات" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/kenar-docs/">ReadMe</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/kenar-docs/addons/">افزونه‌های صفحهٔ آگهی</a><button aria-label="باز کردن دسته بندی در نوار کناری &#x27;افزونه‌های صفحهٔ آگهی&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/kenar-docs/assets/">اَسِت‌ها assets</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/kenar-docs/chat/">💬 افزونه‌های چت دیوار</a><button aria-label="باز کردن دسته بندی در نوار کناری &#x27;💬 افزونه‌های چت دیوار&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/kenar-docs/events/">دریافت رویدادها در لحظه</a><button aria-label="باز کردن دسته بندی در نوار کناری &#x27;دریافت رویدادها در لحظه&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/kenar-docs/finder/">دریافت اطلاعات آگهی</a><button aria-label="باز کردن دسته بندی در نوار کناری &#x27;دریافت اطلاعات آگهی&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/kenar-docs/management/">پنل مدیریت اپلیکیشن‌ها</a><button aria-label="باز کردن دسته بندی در نوار کناری &#x27;پنل مدیریت اپلیکیشن‌ها&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/kenar-docs/migrations/user_addon_v2+addon_v2+user_semantic">migrations</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kenar-docs/migrations/user_addon_v2+addon_v2+user_semantic">مهاجرت افزونه</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/kenar-docs/migrations/send_message_v2+events">مهاجرت ارسال پیام و رویداد‌ها</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kenar-docs/migrations/search_posts_v2">مهاجرت تغییرات جست‌و‌جوی آگهی</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/kenar-docs/misc/">متفرقه</a><button aria-label="باز کردن دسته بندی در نوار کناری &#x27;متفرقه&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/kenar-docs/oauth/">احراز باز</a><button aria-label="باز کردن دسته بندی در نوار کناری &#x27;احراز باز&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/kenar-docs/payment-ticket/">فلوی تیکت پرداخت</a><button aria-label="باز کردن دسته بندی در نوار کناری &#x27;فلوی تیکت پرداخت&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/kenar-docs/post/edit_post">post</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/kenar-docs/semantic/">اطلاعات معنایی</a><button aria-label="باز کردن دسته بندی در نوار کناری &#x27;اطلاعات معنایی&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/kenar-docs/standards/">استانداردها</a><button aria-label="باز کردن دسته بندی در نوار کناری &#x27;استانداردها&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/kenar-docs/widgets/">ساختار ویجت های دیوار (Widgets)</a><button aria-label="باز کردن دسته بندی در نوار کناری &#x27;ساختار ویجت های دیوار (Widgets)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="نشانگر صفحات"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="صفحه اصلی" class="breadcrumbs__link" href="/kenar-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">migrations</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">مهاجرت ارسال پیام و رویداد‌ها</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">مطالب این صفحه</button></div><div class="theme-doc-markdown markdown"><header><h1>مهاجرت ارسال پیام و رویداد‌ها</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="لیست-تغییرات">لیست تغییرات<a href="#لیست-تغییرات" class="hash-link" aria-label="لینک مستقیم به لیست تغییرات" title="لینک مستقیم به لیست تغییرات">​</a></h2>
<ul>
<li>تغییر ساختار اکشن‌ها:‌ با جایگزین شدن اکشن‌های قدیمی توسط اکشن‌های جدید،امکان دریافت اطلاعات بیشتر و متنوع تری را دارید. علاوه بر این، اکشن‌های افزونه‌ها و چت یکپارچه شدند.</li>
<li>اضافه شدن API جدید ارسال پیام در چت: از این به بعد تنها با استفاده از پارامتر conversation_id به هر مکالمه‌ای پیام بفرستید.  با استفاده از این API می‌توانید اولین پیام را در مکالمه‌ها بفرستید.</li>
<li>امکان اضافه کردن چندین دکمه با اکشن‌های مختلف: شما می‌توانید  برای تعامل با کاربران در چت بعد از هر پیام تان تا ۹ دکمه قرار دهید.</li>
<li>ساختار جدید هدایت کاربران به سمت برنامه‌ی شما: با استفاده از این ساختار می‌توانید علاوه بر داده‌هایی که خودتان تعریف می‌کنید، اطلاعات اضافه‌تری از کاربر بسته به مکانی که کاربر از آن به سمت برنامه‌ی شما هدایت می‌شود دریافت کنید.</li>
<li>ساختار جدید گوش دادن به رویداد‌های دیوار: با استفاده از ساختار یکپارچه رویدادها می‌توانید از اتفاقاتی که در دیوار رخ می‌دهد، در لحظه با خبر شوید.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="مهاجرت">مهاجرت<a href="#مهاجرت" class="hash-link" aria-label="لینک مستقیم به مهاجرت" title="لینک مستقیم به مهاجرت">​</a></h2>
<p>مهم ترین موردی که برای مهاجرت به این ورژن باید به آن توجه کنید، اسکوپ جدید برای ارسال پیام در چت هست. شما با داشتن اسکوپ <code>CONVERSATION_SEND_MESSAGE</code> می‌توانید از API جدید استفاده کنید. ابتدا مطمئن شوید که اپ شما به این اسکوپ دسترسی دارد و سپس با درخواست این دسترسی از کاربران‌تان، این اجازه را دریافت کنید. سپس با فراخوانی API <a href="/kenar-docs/chat/users_conversations#%D8%AF%D8%B1%D8%AE%D9%88%D8%A7%D8%B3%D8%AA-%D8%A7%D8%B1%D8%B3%D8%A7%D9%84-%D9%BE%DB%8C%D8%A7%D9%85-%D8%AF%D8%B1-%DA%86%D8%AA">ارسال پیام در چت</a> پیام مورد نظر خود را در چت ارسال کنید.</p>
<p>همچنین برای هدایت کاربر به سمت برنامه‌ی شما، در ساختار جدید ابتدا درخواستی به آدرس شروع برنامه‌ی شما (تعریف شده در پنل کنار دیوار) ارسال می‌شود که حاوی اطلاعات مربوط به کاربر است و انتظار می‌رود که در پاسخ به این درخواست، آدرسی  که کاربر باید به آن هدایت شود را برگردانید. تفاوت این نسخه‌ با حالت قبلی، ساختار درخواستی است که برای شما ارسال می‌شود. در صورتی که از هر دو روش برای هدایت کاربر استفاده می‌کنید باید با استفاده از HTTP Header <code>API_VERSION</code> تشخیص دهید که این درخواست مربوط به کدام نسخه هست و سپس اطلاعات مورد نظر را بررسی کنید و آدرس بازگشت کاربر را به عنوان پاسخ برگردانید. اطلاعات بیشتر در مورد این درخواست را می‌توانید <a href="/kenar-docs/widgets/actions/open_server_link">اینجا</a> ببینید.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ارسال-پیام-در-چت">ارسال پیام در چت<a href="#ارسال-پیام-در-چت" class="hash-link" aria-label="لینک مستقیم به ارسال پیام در چت" title="لینک مستقیم به ارسال پیام در چت">​</a></h3>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- POST https://api.divar.ir/v2/open-platform/chat/conversation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ POST https://api.divar.ir/v2/open-platform/conversations/{{conversation_id}}/messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x-api-key: {{apikey}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x-access-token: {{access_token}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-   &quot;user_id&quot;: &quot;شناسهٔ کاربر فرستنده که می خواهیم پیامی از سمت او وارد چت کنیم&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-   &quot;post_token&quot;: &quot;توکن آگهی مورد چت&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-   &quot;peer_id&quot;: &quot;شناسهٔ کاربر گیرنده در چت&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;type&quot;: &quot;TEXT&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;message&quot;: &quot;متن پیام&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-   &quot;sender_btn&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-       &quot;action&quot;: &quot;LINK&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-       &quot;data&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-           &quot;icon_name&quot;: &quot;نام آیکون مورد نظر برای این دکمه&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-           &quot;extra_data&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-               &quot;your_custom_key&quot;:&quot;اطلاعاتی که در ادامه هنگام کلیک روی دکمه نیاز داریم&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-           },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-           &quot;caption&quot;: &quot;متن دکمهٔ زیر پیام برای طرف فرستنده&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-       }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-   },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-   &quot;receiver_btn&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-       &quot;action&quot;: &quot;LINK&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-       &quot;data&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-           &quot;icon_name&quot;: &quot;نام آیکون مورد نظر برای این دکمه&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-           &quot;extra_data&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-               &quot;your_custom_key&quot;:&quot;اطلاعاتی که در ادامه هنگام کلیک روی دکمه نیاز داریم&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-           },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-           &quot;caption&quot;: &quot;متن دکمهٔ زیر پیام برای طرف گیرنده&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-       }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-   }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+   &quot;sender_buttons&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+       &quot;rows&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+           {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+               &quot;buttons&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                   {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                       &quot;action&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                           &quot;open_direct_link&quot;: &quot;آدرس مورد نظر برای باز شدن بعد از کلیک&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                       },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                       &quot;icon_name&quot;: &quot;نام آیکون&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                       &quot;caption&quot;: &quot;متن دکمه&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                   },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                   {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                       &quot;action&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                           &quot;open_server_link&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                               &quot;data&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                                   &quot;my_key_1&quot;: &quot;value&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                                   &quot;my_key_2&quot;: &quot;value2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                               }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                           }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                       },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                       &quot;icon_name&quot;: &quot;نام آیکون&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                       &quot;caption&quot;: &quot;متن دکمه&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                   }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+               ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+           }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+       ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+   },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+   &quot;receiver_buttons&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+       &quot;rows&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+           {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+               &quot;buttons&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                   {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                       &quot;action&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                           &quot;open_direct_link&quot;: &quot;آدرس مورد نظر برای باز شدن بعد از کلیک&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                       },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                       &quot;icon_name&quot;: &quot;نام آیکون&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                       &quot;caption&quot;: &quot;متن دکمه&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                   },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                   {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                       &quot;action&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                           &quot;open_server_link&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                               &quot;data&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                                   &quot;my_key_1&quot;: &quot;value&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                                   &quot;my_key_2&quot;: &quot;value2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                               }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                           }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                       },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                       &quot;icon_name&quot;: &quot;نام آیکون&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                       &quot;caption&quot;: &quot;متن دکمه&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                   }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+               ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+           }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+       ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+   }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="خواندن-در-لحظهی-پیامهای-یک-آگهی">خواندن در لحظه‌ی پیام‌های یک آگهی<a href="#خواندن-در-لحظهی-پیامهای-یک-آگهی" class="hash-link" aria-label="لینک مستقیم به خواندن در لحظه‌ی پیام‌های یک آگهی" title="لینک مستقیم به خواندن در لحظه‌ی پیام‌های یک آگهی">​</a></h3>
<p>این API با این نسخه از داک، depcrecate شده است و می‌توانید با استفاده از سرویس گوش دادن به رویدادها از پیام‌های جدید در چت یک آگهی (از طرف آگهی گذار) آگاه شوید.</p>
<p>درخواست گوش دادن به پیام‌های یک آگهی</p>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- POST https://api.divar.ir/v1/open-platform/notify/chat/post-conversations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ POST https://api.divar.ir/v1/open-platform/events/subscriptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x-api-key: {{apikey}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x-access-token: {{access_token}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-   &quot;post_token&quot;: &quot;توکن آگهی&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-   &quot;endpoint&quot;: &quot;آدرسی که پیام‌ها به آن فرستاده می‌شوند&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-   &quot;identification_key&quot;: &quot;کلید احراز منبع درخواست‌ها&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+   &quot;event_type&quot;: &quot;NEW_MESSAGE_ON_POST&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+   &quot;event_resource_id&quot;: &quot;gZd7omnS&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+   &quot;meta_data&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+       &quot;your_key&quot;: &quot;your_value&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+   }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>درخواست ارسالی از طرف دیوار
با توجه به تغییر کامل ساختار درخواست ارسالی از طرف دیوار، پیشنهاد می‌شود که داک <a href="/kenar-docs/events#%D8%AF%D8%B1%D8%AE%D9%88%D8%A7%D8%B3%D8%AA-%D8%B1%D9%88%DB%8C%D8%AF%D8%A7%D8%AF-%D8%AC%D8%AF%DB%8C%D8%AF-%D8%A7%D8%B1%D8%B3%D8%A7%D9%84%DB%8C-%D8%A7%D8%B2-%D8%B3%D9%85%D8%AA-%D8%AF%DB%8C%D9%88%D8%A7%D8%B1">درخواست رویداد جدید</a> را مطالعه کنید.</p>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- POST {{ endpoint }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ POST {{new_events_url}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- authorization: {{ identification_key }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ Authorization: {{identification_key}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-   &quot;payload&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-     &quot;data&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-       &quot;text&quot;: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-     },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-     &quot;sender&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-       &quot;id&quot;: &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-       &quot;is_supply&quot;: bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-     },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-     &quot;id&quot;: &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-     &quot;metadata&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-       &quot;category&quot;: &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-       &quot;post_token&quot;: &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-       &quot;title&quot;: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-     },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-     &quot;sent_at&quot;: &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-     &quot;receiver&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-       &quot;id&quot;: &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-       &quot;is_supply&quot;: bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-     },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-     &quot;type&quot;: &quot;TEXT&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-   },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-   &quot;timestamp&quot;: &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-   &quot;type&quot;: &quot;CHAT_MESSAGE&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+   &quot;type&quot;: &quot;NEW_MESSAGE&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+   &quot;meta_data&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+        &quot;your_key&quot;: &quot;your_value&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+   &quot;new_message&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+       &quot;id&quot;: &quot;e7a08a2c-8ee4-11ef-af85-4e9e9bfa3c12&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+       &quot;conversation&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+           &quot;id&quot;: &quot;edbb9499-cccc-4d35-b21f-621fa95f2b3e&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+           &quot;type&quot;: &quot;POST&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+           &quot;post_token&quot;: &quot;gZd7omnS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+       },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+       &quot;sender&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+           &quot;side&quot;: &quot;SELLER&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+           &quot;type&quot;: &quot;HUMAN&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+       },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+       &quot;type&quot;: &quot;TEXT&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+       &quot;sent_at&quot;: 1729429926140000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+   }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="کپی به کلیپ‌بورد" title="کپی" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/divar-ir/kenar-docs/tree/main/docs/docs/migrations/002_send_message_v2+events.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>ویرایش مطالب این صفحه</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="صفحات مستندات"><a class="pagination-nav__link pagination-nav__link--prev" href="/kenar-docs/migrations/user_addon_v2+addon_v2+user_semantic"><div class="pagination-nav__sublabel">قبلی</div><div class="pagination-nav__label">مهاجرت افزونه</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/kenar-docs/migrations/search_posts_v2"><div class="pagination-nav__sublabel">بعدی</div><div class="pagination-nav__label">مهاجرت تغییرات جست‌و‌جوی آگهی</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#لیست-تغییرات" class="table-of-contents__link toc-highlight">لیست تغییرات</a></li><li><a href="#مهاجرت" class="table-of-contents__link toc-highlight">مهاجرت</a><ul><li><a href="#ارسال-پیام-در-چت" class="table-of-contents__link toc-highlight">ارسال پیام در چت</a></li><li><a href="#خواندن-در-لحظهی-پیامهای-یک-آگهی" class="table-of-contents__link toc-highlight">خواندن در لحظه‌ی پیام‌های یک آگهی</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">2025 © <a href="https://divar.ir/kenar" target="_blank">کنار دیوار</a></div></div></div></footer></div>
</body>
</html>