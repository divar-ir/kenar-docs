# ุงุฑุณุงู ูพุงู ุฏุฑ ฺุช

ุจุฑูุงููโโูุง ฺฉูุงุฑ ุฏูุงุฑ ูโุชูุงููุฏ ูพุณ ุงุฒ [ฺฉุณุจ ุงุฌุงุฒู ุงุฒ ฺฉุงุฑุจุฑ][ุงุญุฑุงุฒ ุจุงุฒ]ุ ุฏุฑ ฺฉ ฺุช ุง ฺุชโูุง ฺฉ ุขฺฏู ูพุงู ุงุฑุณุงู ฺฉููุฏ.
ูพุงูโูุง ุงุฑุณุงู ุงุฒ ุทุฑู ฺฉุงุฑุจุฑ ฺฉู ุฏุณุชุฑุณ ุจู ุจุฑูุงูู ุฑุง ุฏุงุฏู ู ุฏุฑุฎูุงุณุช ุงุฒ ุณูุชุด ุจูุฏู ุฏุฑ ฺุช ุงุฑุณุงู ูโุดูุฏ ู ูุฑ ุฏู ุทุฑู ฺุช ฺฉ ูุชู ูพุงู ูโุจููุฏุ ุงูุง ุงูฺฉุงู ุฏุฑุฌ ุฏฺฉููู ูุชูุงูุช ุจุฑุง ุทุฑูู ฺุช ูุฌูุฏ ุฏุงุฑุฏ.\
ุจู ุนูุงูู ุฏุฑ ูุณูุช ุจุงูุง ูพุงูุ ุนููุงู ุจุฑูุงููู ููุฑุฏ ูุธุฑ ูุดุงู ุฏุงุฏู ูโุดูุฏ.

| ![ููุง ุงุฒ ฺฉ ูพุงู ุงุฑุณุงู ุดุฏู ุชูุณุท ุจุงุช](/img/bot-message.png) |
|:------------------------------------------------------------:|
|   <sub dir="rtl">ููุง ุงุฒ ฺฉ ูพุงู ุงุฑุณุงู ุดุฏู ุชูุณุท ุจุงุช</sub>   |

> โญ๏ธ ุจูุชุฑ ุงุณุช ูพุงู ฺฉู ุฏุฑ ฺุช ุงุฑุณุงู ูโฺฉูุฏ ุจุฑุง ูุฑ ุฏู ุทุฑู ูุนูุงุฏุงุฑ ุจุงุดุฏ ู ุงุทูุงุนุงุช ููุฏ ุฏุฑ ุฑุงุณุชุง ุฎุฏูุช ุฏุฑุงูุช ุดุฏู ุงุฑุงุฆู ุฏูุฏ.

> ๐ ุจุฑุง ููุงุตุฏ ุชุจูุบุงุช ุง ูุนุฑู ุงูฺฉุงูุงุช ู ุฎุฏูุงุชุชุงู ูพุงู ุงุฑุณุงู ูฺฉูุฏ.

## ุฏุณุชุฑุณ ุงุฑุณุงู ูพุงู ุฏุฑ ฺุช

ุจุฑุง ุงูฺฉู ุจุชูุงูุฏ ุฏุฑ ฺฉ ฺุช ูพุงู ุงุฑุณุงู ฺฉูุฏุ ูุงุฒ ุงุณุช ุชุง ุงุฌุงุฒูู ุฏุณุชุฑุณ ุฏุฑ ุฏู ููุทู ูุฑุงูู ุดุฏูโุจุงุดุฏ:\
ฑ. ุจุฑูุงููู ุดูุง ุจู ุตูุฑุช ฺฉู ุฏุณุชุฑุณ ูุงุฒู ุฑุง ุฏุฑ [ูพูู ฺฉูุงุฑ ุฏูุงุฑ][ูพูู ฺฉูุงุฑ] ฺฏุฑูุชูโุจุงุดุฏ.\
ฒ. [ุงุฒ ฺฉุงุฑุจุฑ ุงุฌุงุฒู ฺฏุฑูุชูโุจุงุดุฏ][ุงุญุฑุงุฒ ุจุงุฒ] ู `access_token` ุงุฑุณุงู ุฏุฑ ุฏุฑุฎูุงุณุชุชุงู ุงู ุงุฌุงุฒู ุฑุง ุฏุงุดุชูโุจุงุดุฏ:
- SCOPE: CONVERSATION_SEND_MESSAGE
- IDENTIFIER: CONVERSATION_ID

ุฏู ููุน ุฏุณุชุฑุณ ุจุฑุง ุงุฑุณุงู ูพุงู ุฏุฑ ฺุช ูุฌูุฏ ุฏุงุฑุฏ ฺฉู ุจุฑุง ูุฑ ฺฉุฏุงู ูโุชูุงู ุฌุฏุงฺฏุงูู ุงุฒ ฺฉุงุฑุจุฑ ุงุฌุงุฒู ฺฏุฑูุช. ุงุฑุณุงู ูพุงู ุฏุฑ **ฺฉ ฺุช** ู ุงุฑุณุงู ูพุงู ุฏุฑ **ฺุชโูุง ฺฉ ุขฺฏู**
ุฌุฒุงุช ู ูพุงุฑุงูุชุฑูุง ูุงุฒู ุจุฑุง ุฏุฑุฎูุงุณุช ุฏุณุชุฑุณ ู ุงุฌุงุฏ `access_token` ุฑุง ุฏุฑ [ุตูุญูู ุงุญุฑุงุฒ ุจุงุฒ][ุงุญุฑุงุฒ ุจุงุฒ] ุจุจูุฏ.

## ุฏุฑุฎูุงุณุช ุงุฑุณุงู ูพุงู ุฏุฑ ฺุช

ุฏุฑ ุตูุฑุช ฺฉู ุงุฌุงุฒูู ุงู ุฏุฑุฎูุงุณุช ุฑู ุทุจู ุชูุถุญุงุช ุจุงูุง ู [ุตูุญูู ุงุญุฑุงุฒ ุจุงุฒ][ุงุญุฑุงุฒ ุจุงุฒ] ุฏุงุดุชูโุจุงุดุฏุ ุจุง ุงุฑุณุงู ุฏุฑุฎูุงุณุช ูุดุงุจู ูููููู ุฒุฑ ูโุชูุงูุฏ ุฏุฑ ฺุช ููุฑุฏ ูุธุฑุชุงู ูพุงู ูุงุฑุฏ ฺฉูุฏ.

ูโุชูุงูุฏ ูุณูุชโูุง ูุงุฑุณ ุฑุง ุจุง ููุงุฏุฑ ุฎูุฏุชุงู ุฌุงฺฏุฒู ฺฉูุฏ:

```http request
POST https://api.divar.ir/v2/open-platform/conversations/{{conversation_id}}/messages
Content-Type: application/json
x-api-key: {{apikey}}
x-access-token: {{access_token}}

{
  "type": "TEXT",
  "message": "ูุชู ูพุงู",
  "sender_buttons": {
    "rows": [
      {
        "buttons": [
          {
            "action": {
              "open_direct_link": "ุขุฏุฑุณ ููุฑุฏ ูุธุฑ ุจุฑุง ุจุงุฒ ุดุฏู ุจุนุฏ ุงุฒ ฺฉูฺฉ"
            },
            "icon_name": "ูุงู ุขฺฉูู",
            "caption": "ูุชู ุฏฺฉูู"
          },
          {
            "action": {
              "open_server_link": {
                "data": {
                  "my_key_1": "value",
                  "my_key_2": "value2"
                }
              }
            },
            "icon_name": "ูุงู ุขฺฉูู",
            "caption": "ูุชู ุฏฺฉูู"
          }
        ]
      }
    ]
  },
  "receiver_buttons": {
    "rows": [
      {
        "buttons": [
          {
            "action": {
              "open_direct_link": "ุขุฏุฑุณ ููุฑุฏ ูุธุฑ ุจุฑุง ุจุงุฒ ุดุฏู ุจุนุฏ ุงุฒ ฺฉูฺฉ"
            },
            "icon_name": "ูุงู ุขฺฉูู",
            "caption": "ูุชู ุฏฺฉูู"
          },
          {
            "action": {
              "open_server_link": {
                "data": {
                  "my_key_1": "value",
                  "my_key_2": "value2"
                }
              }
            },
            "icon_name": "ูุงู ุขฺฉูู",
            "caption": "ูุชู ุฏฺฉูู"
          }
        ]
      }
    ]
  }
}
```

### ุฏุฑุฎูุงุณุช

| Field Name       | Field Type                | Description                                      |
|------------------|---------------------------|--------------------------------------------------|
| type             | String                    | ููุน ูุญุชูุง ุฑุง ูุดุฎุต ูโฺฉูุฏุ ุฏุฑ ุญุงู ุญุงุถุฑ ููุท "TEXT" |
| message          | String                    | ูุญุชูุง ูุชู ูพุงู                                  |
| sender_buttons   | [ButtonGrid](#ButtonGrid) | ุดุงูู ูพฺฉุฑุจูุฏ ุฏฺฉููโูุง ุจุฑุง ูุฑุณุชูุฏู               |
| receiver_buttons | [ButtonGrid](#ButtonGrid) | ุดุงูู ูพฺฉุฑุจูุฏ ุฏฺฉููโูุง ุจุฑุง ฺฏุฑูุฏู                |

### ButtonGrid

| Field Name | Field Type                     | Description                             |
|------------|--------------------------------|-----------------------------------------|
| rows       | Array[[ButtonRow](#ButtonRow)] | ุขุฑุงูโุง ุงุฒ ุฑุฏู ุฏฺฉููโูุง. ุญุฏุงฺฉุซุฑ ณ ุฑุฏู |


### ButtonRow

| Field Name | Field Type               | Description                                   |
|------------|--------------------------|-----------------------------------------------|
| buttons    | Array[[Button](#Button)] | ุขุฑุงูโุง ุงุฒ ุฏฺฉููโูุง. ุญุฏุงฺฉุซุฑ ณ ุฏฺฉูู ุฏุฑ ูุฑ ุฑุฏู |


### Button

| Field Name | Field Type                 | Description                                     |
|------------|----------------------------|-------------------------------------------------|
| action     | [Action](/widgets/actions) | ุงฺฉุดู ฺฉู ูพุณ ุงุฒ ฺฉูฺฉ ฺฉุงุฑุจุฑ ุจุฑ ุฑู ุฏฺฉูู ุฑุฎ ูโุฏูุฏ |
| icon_name  | String                     | ูุงู ุขฺฉูู ููุงุด ุฏุงุฏูโุดุฏู ุจุฑ ุฑู ุฏฺฉูู            |
| caption    | String                     | ูุชู ฺฉู ุจุฑ ุฑู ุฏฺฉูู ููุงุด ุฏุงุฏู ูโุดูุฏ           |

ุฏุฑ ุฏุฑุฎูุงุณุช ุจุงูุงุ ฺฉุงุฑุจุฑุงู ุจุง [ุฒุฏู ุฑู ุฏฺฉููู ูพุงู][ุจุงุฒุดุฏู ุจุฑูุงูู]ุ ุฏุฑ ูุงูุจ webview ุง pop-up ุจู ุจุฑูุงููู ุดูุง ูุงุฑุฏ ูโุดููุฏุ ุฏุฑ ุตูุฑุช ฺฉู ูุงุฒ ุจู ุจุงุฒ ฺฉุฑุฏู ุตูุญูู ุฎูุฏ ุจู ุตูุฑุช ูุณุชูู ุฏุฑ ูุฑูุฑฺฏุฑ ุฏุงุฑุฏุ ูโุชูุงูุฏ ูฺฺฏโูุง ุฏฺฉูู ุฑุง ุจู ุดฺฉู ุฒุฑ ุชุบุฑ ุฏูุฏ.

```
{
    "sender_btn": {
        "action": "DIRECT_LINK",
        "data": {
            "icon_name": "ูุงู ุขฺฉูู ููุฑุฏ ูุธุฑ ุจุฑุง ุงู ุฏฺฉูู",
            "direct_link": "ุขุฏุฑุณ ุตูุญูู ููุฑุฏ ูุธุฑ ุจุฑุง ุจุงุฒ ุดุฏู ููฺฏุงู ฺฉูฺฉ",
            "caption": "ูุชู ุฏฺฉููู ุฒุฑ ูพุงู ุจุฑุง ุทุฑู ูุฑุณุชูุฏู"
        }
    }
}
```

### ุฎุทุงูุง

ููฺฉู ุงุณุช ุฏุฑ ูพุงุณุฎ ุงู ุฏุฑุฎูุงุณุช ุฎุทุง ุจู ุตูุฑุช ุฒุฑ ุฏุฑุงูุช ุดูุฏ:
```HTTP
HTTP/1.1  412
{
    "code": 9,
    "message": "message delivery failed due to recipient's restriction"
}
```
ุงู ุฎุทุง ุจู ฺูุฏ ุฏูู ู โุชูุงูุฏ ุฏุฑุงูุช ุดูุฏ:
- ฺฉุงุฑุจุฑ ุชูุณุท ฺฉุงุฑุจุฑ ููุงุจู ุฏุฑ ฺุช ูุณุฏูุฏ ุดุฏู ุจุงุดุฏ
- ฺฉุงุฑุจุฑ ุง ฺฉุงุฑุจุฑ ููุงุจู ุฏุฑ ุจูฺฉ ูุณุช ุจุงุดูุฏ.
- ...
## ุฏุณุชุฑุณ ุงุฑุณุงู ูพุงู ุฏุฑ ุชูุงู ูฺฉุงููุงุช ฺฉ ุขฺฏู (ุขุฒูุงุด)

ุฏุณุชุฑุณ ูุจู ุชููุง ูุฑุจูุท ุจู ฺฉ ูฺฉุงููู ูโุจุงุดุฏุ ุงูุง ุจุง ุฏุงุดุชู ุงู ุฏุณุชุฑุณ ูโุชูุงูุฏ ุฏุฑ ุชูุงู ูฺฉุงููุงุช ูุฑุจูุท ุจู ฺฉ ุขฺฏู ุงุฒ ุทุฑู ุขฺฏู ฺฏุฐุงุฑ ูพุงู ุจูุฑุณุชุฏ:
- SCOPE: CHAT_POST_CONVERSATIONS_MESSAGE_SEND
- IDENTIFIER: POST_TOKEN

## ฺฉูฺฉ ฺฉุงุฑุจุฑ ุฑู ุฏฺฉููู ุฏุฑุฌ ุดุฏู ุฒุฑ ูพุงู

ุฏุฑ ุตูุฑุช ฺฉู ฺฉุงุฑุจุฑ ุฑู ุฏฺฉููโุง ฺฉู ุฒุฑ ูพุงู ุงุถุงูู ฺฉุฑุฏูโุงุฏ ฺฉูฺฉ ฺฉูุฏุ ุงุจุชุฏุง ุฏูุงุฑ ฺฉ ุฏุฑุฎูุงุณุช ุจู ุขุฏุฑุณ ฺฉู ุฏุฑ ุงุจุชุฏุง ุชูุธู ฺฉุฑุฏูโุงุฏ ูโุฒูุฏ. [ุชูุถุญุงุช ุจุดุชุฑ](/management#session-initialization-url/)

ุจู ููุฑุงู ุงู ุฏุฑุฎูุงุณุช ููุงุฑุฏ ุฒุฑ ุงุฑุณุงู ุฎูุงููุฏ ุดุฏ ู ุณูพุณ ฺฉุงุฑุจุฑ ุจู ุขุฏุฑุณ ฺฉู ุฏุฑ ุฏฺฉููู ููุฑุฏ ูุธุฑ ุฏุฑุฌ ุดุฏูโุงุณุช ูุฏุงุช ูโุดูุฏ.

ูููููู ูุญุชูุง ุงุฑุณุงู ุฏุฑุฎูุงุณุช ุงุฒ ุณูุช ุฏูุงุฑ

```JSON
{
    "extra_data": {
        "provider_data": {"your_custom_key":"ุงุทูุงุนุงุช ฺฉู ุฏุฑ ุฏุฑุฎูุงุณุช ุงุฑุณุงู ูพุงู ุฏุฑ ูุฑุญููู ูุจู ูุฑุณุชุงุฏุฏ"}
    },
    "callback_url": "ุขุฏุฑุณ ฺฉู ฺฉุงุฑุจุฑ ูพุณ ุงุฒ ุงูุฌุงู ูุฑุงูุฏ ุฏุฑ ุณุฑูุณ ุดูุง ุจุงุฏ ุจู ุขู ูุฏุงุช ุดูุฏ",
    "post_token":   "ุชูฺฉู ุขฺฏู",
    "user_id":      "ุดูุงุณูู ฺฉุณ ฺฉู ุฑู ููฺฉ ฺฉูฺฉ ฺฉุฑุฏู ุง ูุฑุงูุฏ ุฑุง ุดุฑูุน ฺฉุฑุฏู",
    "peer_id":      "ุดูุงุณูู ุทุฑู ููุงุจู ฺุช",
    "supplier": {
        "id": "ุดูุงุณูู ฺฉุงุฑุจุฑ ูุฑูุดูุฏู (ุตุงุญุจ ุขฺฏู)"
    },
    "demand": {
        "id": "ุดูุงุณูู ฺฉุงุฑุจุฑ ุฎุฑุฏุงุฑ"
    },
    "conversation_id": "ุดูุงุณู ูฺฉุงููู"
}

```

ุฏุฑ ูพุงุณุฎ ุจู ุงู ุฏุฑุฎูุงุณุชุ ูโุจุงุณุช ุขุฏุฑุณ ุฑุง ุจู ุดฺฉู ุฒุฑ ุจุฑฺฏุฑุฏุงูุฏ. ฺฉุงุฑุจุฑ ุจู ุฃุฏุฑุณ ฺฉู ุฏุฑ ูุณูุช `url` ูพุงุณุฎ ุดูุงุณุช ูุฏุงุช ูโุดูุฏ ู ุจุง ุจุฑูุงููู ุชุญุช ูุจ ุดูุง ุชุนุงูู ูโฺฉูุฏ.

```JSON
{
  "status": "200",
  "message": "success",
  "url": "https://yourdomain.com/some/where/to/start"
}
```

<br>

[ุงุญุฑุงุฒ ุจุงุฒ]: /oauth
[API key]: /management/api-keys.md
[ูพูู ฺฉูุงุฑ]: /management
[ุงุฑุณุงู ูพุงู ุฏุฑ ฺฉ ฺุช]: #ุงุฑุณุงู-ูพุงู-ุฏุฑ-ฺฉ-ฺุช
[ุงุฑุณุงู ูพุงู ุฏุฑ ฺุชโูุง ุขฺฏู]: #ุงุฑุณุงู-ูพุงู-ุฏุฑ-ฺุชูุง-ฺฉ-ุขฺฏู
[ุจุงุฒุดุฏู ุจุฑูุงูู]: #ฺฉูฺฉ-ฺฉุงุฑุจุฑ-ุฑู-ุฏฺฉููู-ุฏุฑุฌ-ุดุฏู-ุฒุฑ-ูพุงู


<br><br>

<div align="center">

<img src="/img/wire-puzzle.svg" height="156px"/>

</div>

<br><br>
