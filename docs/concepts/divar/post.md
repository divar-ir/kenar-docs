# آگهی (Post)
<div dir="rtl">
### مقدمه

در اکوسیستم دیوار، موجودیت (Entity) محوری و اصلی، **آگهی** یا **Post** می‌باشد. در پلتفرم کنار دیوار نیز این مفهوم بنیادین با همان ساختار و اهمیت وجود دارد. این مستند به منظور آشنایی عمیق توسعه‌دهندگان با جزئیات و ویژگی‌های خاص آگهی در پلتفرم کنار تهیه شده است.

### توکن (شناسه) آگهی

در دیوار، هر آگهی [**فعال**](#وضعیت-آگهی) یک شناسه‌ی متنی منحصر به فرد دارد که به آن **توکن آگهی** (Post Token) گفته می‌شود. این توکن کلید اصلی برای دسترسی و ارجاع به یک آگهی خاص است.

**نحوه مشاهده و ساختار توکن آگهی:**
برای درک بهتر مفهوم توکن، می‌توانید به وب‌سایت دیوار (<span dir="ltr">[divar.ir](https://divar.ir)</span>) مراجعه کنید. پس از جستجو و کلیک بر روی یک آگهی، به آدرس URL آن در مرورگر خود توجه کنید. این URL ساختاری مشابه زیر دارد:

![post-url-image](./post-site-url.png)

فرمت لینک‌های آگهی به صورت <span dir="ltr">`https://divar.ir/v/{بخش-مربوط-به-سئو-و-خوانایی-URL}/{توکن-آگهی}`</span> می‌باشد.
به عنوان مثال: <span dir="ltr">`https://divar.ir/v/فروش-فوری-آپارتمان-اکازیون/gW4fL8Xq`</span>

در این مثال:

- <span dir="ltr">`gW4fL8Xq`</span> همان **توکن آگهی** است.
- <span dir="ltr">`فروش-فوری-آپارتمان-اکازیون`</span> بخشی است که برای بهبود خوانایی URL و بهینه‌سازی برای موتورهای جستجو (SEO) استفاده می‌شود و در شناسایی یکتای آگهی نقشی ندارد.

> **مشخصات فنی توکن آگهی:**
>
> - **طول:** معمولاً ۸ یا ۹ کاراکتر.
> - **کاراکترهای مجاز:** ترکیبی از حروف بزرگ و کوچک انگلیسی و اعداد (<span dir="ltr">`[_a-zA-Z0-9]`</span>).
> - **ملاحظات ذخیره‌سازی برای توسعه‌دهندگان:** با توجه به اینکه طول این توکن ممکن است در آینده تا حداکثر ۱۶ کاراکتر افزایش یابد، هنگام طراحی پایگاه داده و تعریف فیلد مربوط به توکن آگهی، حتماً این افزایش احتمالی را در نظر بگیرید (مثلاً VARCHAR(20) یا بیشتر).

#### توکن مدیریت (Management Token)

توکن آگهی یک شکل دیگر نیز دارد که به آن **توکن مدیریت** گفته می‌شود. این توکن معمولاً از توکن عمومی آگهی طولانی‌تر است، اما پیشوند (prefix) آن با توکن عمومی آگهی یکسان می‌باشد.

**مثال:**
اگر توکن عمومی آگهی <span dir="ltr">`post1234`</span> باشد، توکن مدیریت آن می‌تواند مقداری شبیه به <span dir="ltr">`post1234mngABCXYZ`</span> داشته باشد (که <span dir="ltr">`mngABCXYZ`</span> پسوند مدیریتی است).

**نکته مهم برای توسعه‌دهندگان پلتفرم کنار:**
هدف از توضیح این بخش صرفاً ارائه اطلاعات تکمیلی برای درک عمیق‌تر سازوکار داخلی دیوار است. پلتفرم کنار **به هیچ وجه و تحت هیچ شرایطی توکن مدیریت (توکن خصوصی) را در اختیار شما قرار نمی‌دهد.**
قابلیت‌هایی نظیر ویرایش آگهی، نردبان کردن، یا سایر عملیات مدیریتی که ممکن است در دیوار مستلزم استفاده از توکن مدیریت باشند، در پلتفرم کنار از طریق **توکن عمومی آگهی** و با استفاده از APIهای مشخص و امنی که پلتفرم کنار برای این منظور ارائه می‌دهد، در دسترس شما خواهند بود. پلتفرم کنار مسئولیت مدیریت تعاملات لازم با سیستم‌های داخلی دیوار را بر عهده دارد.

### محتوای آگهی

هر آگهی در دیوار، ساختاری شبیه به یک سند (Document) یا یک فایل با اسکیمای (Schema) تعریف‌شده دارد. محتوای آگهی شامل دو بخش اصلی است:

1.  **فراداده‌های (Metadata) ثابت:** مجموعه‌ای از فیلدهای مشخص و ثابت که برای تمام آگهی‌ها، صرف‌نظر از دسته‌بندی، مشترک هستند و فرمت معینی دارند. مهم‌ترین این فراداده‌ها عبارتند از:

    - **توکن (Token):** شناسه‌ی منحصر به فرد آگهی که پیش‌تر توضیح داده شد.
    - **عنوان (Title):** عنوان اصلی آگهی.
    - **توضیحات (Description):** متن توضیحات آگهی.
    - **دسته‌بندی (Category):** شناسه یا نام دسته‌بندی اصلی که آگهی به آن تعلق دارد (مثلاً: <span dir="ltr">`real_estate`, `cars`, `electronics`</span>).
    - **شهر (City):** شناسه‌ی شهر محل آگهی.
    - **منطقه (District/Neighborhood):** شناسه‌ی منطقه یا محله‌ی دقیق‌تر در شهر (در صورت وجود و انتخاب کاربر).
    - **وضعیت (Status):** وضعیت فعلی آگهی (مثلاً: <span dir="ltr">`published`, `pending_payment`, `expired`, `deleted`, `unconfirmed`</span>). این وضعیت چرخه حیات آگهی را مشخص می‌کند.
    - **لیست تصاویر (Image List/URLs):** آرایه‌ای (لیستی) از شناسه‌ها یا URLهای تصاویر مرتبط با آگهی. این لیست می‌تواند در صورت عدم وجود تصویر، خالی باشد. ترتیب تصاویر در این لیست معمولاً مهم است.
    - **امکان چت (Chat Enabled):** یک مقدار بولی (boolean: <span dir="ltr">`true`</span> یا <span dir="ltr">`false`</span>) که نشان می‌دهد آیا قابلیت چت دیوار برای این آگهی از سوی آگهی‌دهنده فعال شده است یا خیر.
    - **زمان ایجاد (Creation Timestamp):** زمان دقیق ایجاد آگهی در سیستم (معمولاً به فرمت استاندارد مانند Unix Timestamp یا ISO 8601).
    - **زمان آخرین به‌روزرسانی (Last Update Timestamp):** زمان آخرین ویرایش یا به‌روزرسانی اطلاعات آگهی.

2.  **فیلدهای وابسته به دسته‌بندی (Category-Specific Fields):** سایر مقادیر، اطلاعات و فیلدهای آگهی، کاملاً بسته به [دسته‌بندی](#دستهبندی) که آگهی به آن تعلق دارد (مانند «املاک مسکونی»، «خودرو سواری»، «موبایل و تبلت» و...)، مقداردهی و تعریف می‌شوند. به عنوان مثال، فیلدهایی مانند «متراژ»، «تعداد اتاق خواب»، «سال ساخت» برای دسته‌بندی املاک، یا «کارکرد کیلومتر»، «رنگ بدنه»، «نوع سوخت» برای دسته‌بندی خودرو معنی‌دار خواهند بود.
3.  **فیلد‌های مربوط به بیزینس**: این فیلد ها در‌ صورتی موجود هستند که پست مربوط به فروشنده املاکی یا فروشگاهی یا ... باشد.

### وضعیت آگهی

بعد از [ثبت آگهی](#TODO) توسط کاربر، آگهی مسیری مانند شکل زیر طی می‌کند:

</div>

```mermaid
stateDiagram-v2
  classDef page text-align:center;
  direction TB
  state if_payment <<choice>>
  state review_choice <<choice>>
  W : Wait for Payment (W)
  N : Under review (N)
  T : Retired (T)
  P : Published (P)
  E : Needs Edit (E)
  [*]-->SubmitNewPost
  SubmitNewPost-->if_payment
  if_payment-->W : needs payment
  W-->N : payment OK
  if_payment-->N : free of charge
  N-->review_choice
  review_choice-->T : reject
  review_choice-->P : approve
  review_choice-->E : needs edit
  E-->N : edited
  T-->[*] : archived\n(after 30 days)
  P-->T : expire
  T-->P : unretire
```

<div dir="rtl">

### دسته‌بندی

تودو

</div>

### TODO

todo
