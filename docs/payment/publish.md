# پرداخت هزینه ثبت آگهی

این API به ارائه‌دهندگان امکان پرداخت هزینه ثبت آگهی کاربر را می‌دهد. با استفاده از این سرویس می‌توانید هزینه ثبت آگهی کاربر را از موجودی برنامه‌ی خود پرداخت کنید.

## دسترسی‌های مورد نیاز

برای استفاده از این API نیاز به دسترسی‌های زیر دارید:
- دسترسی OAuth: `PAYMENT_ALL_POSTS_PUBLISH`
- دسترسی API Key: `POST_PUBLISH`

## پرداخت هزینه ثبت آگهی

```http request
POST https://open-api.divar.ir/experimental/open-platform/post/{{post_token}}/publish
Content-Type: application/json
x-api-key: {{apikey}}
Authorization: Bearer {{access_token}}

{
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "extra_details": "Details for tracking purposes"
}
```

## پارامترهای درخواست

|    پارامتر     |  نوع   | اجباری |                                                                                                                                                                                                                                                       توضیحات |
|:--------------:|:------:|:-------:|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|
|  `post_token`  | string |   بله   | توکن آگهی دریافت شده از API SubmitUserPost. شناسه منحصر به فرد ۸ تا ۹ کاراکتری برای آگهی ثبت شده توسط کاربر |
|      `id`      | string |   بله   | یک UUID نسخه ۴ که باید برای هر پرداخت منحصر به فرد باشد. این uuid باید از سمت شما تولید شده و در درخواست ارسال شود. اگر id ای ارسال شود که تراکنش موفق یا نیمه موفقی در سمت کنار داشته باشد، خطا دریافت خواهید کرد |
| `extra_details` | string |  خیر   |                                                                                                                     جزئیات اضافی که می‌خواهید به سمت کنار ارسال کنید. این فیلد اختیاری است و می‌تواند برای حل ناسازگاری‌های تراکنش استفاده شود |

## پاسخ

```json
{
    "transaction": {
        "id": "550e8400-e29b-41d4-a716-446655440000",
        "app_slug": "my-app",
        "cost_rials": "500000",
        "created_at": "2025-11-11T09:56:53.833313Z",
        "extra_details": "Details for tracking purposes",
        "state": "TRANSACTION_STATE_COMPLETED",
        "type": "TRANSACTION_TYPE_SUBMIT"
    }
}
```

## پارامترهای پاسخ

### شیء Transaction

|     پارامتر     |    نوع    |                                     توضیحات |
|:---------------:|:---------:|--------------------------------------------:|
|      `id`       |  string   |        همان uuid که در درخواست ارسال شده |
|   `app_slug`    |  string   |        شناسه اپلیکیشنی که تراکنش را ایجاد کرده است |
|  `cost_rials`   |   int64   |      هزینه تراکنش به ریال برای برنامه‌ی شما |
| `created_at`   | Timestamp |                           زمان ایجاد تراکنش |
| `extra_details` |  string   | همان جزئیات اضافی که در درخواست ارسال کردید |
|     `state`     |   State   |                                وضعیت تراکنش |
|     `type`      |   Type    |                                  نوع تراکنش (TRANSACTION_TYPE_SUBMIT) |

## نکات مهم

- قبل از استفاده از این API، حتماً از API قیمت‌گذاری آگهی برای دریافت هزینه و فراهم بودن امکان ثبت آگهی استفاده کنید
- هر UUID فقط یک بار قابل استفاده است
- در صورت موفقیت، هزینه ثبت آگهی از موجودی برنامه‌ی شما کسر خواهد شد
